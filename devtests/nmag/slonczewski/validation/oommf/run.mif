# MIF 2.1

set basename spinxfer-onespin

set pi [expr 4*atan(1.0)]
set mu0 [expr 4*$pi*1e-7]

Parameter I 5e-3    ;# 1e-6
Parameter Happ 10.0 ;# Field in mT

Parameter Ms  860e3

Parameter Polarization 0.4

Parameter theta 40  ;# Polarization direction,
Parameter phi   90  ;# in spherical coordinates

Parameter scale 0.1
Parameter length [expr {125e-9*$scale}]
Parameter width  [expr {125e-9*$scale}]
Parameter thick    5e-9

set current_density [expr {$I*$scale*$scale/($length*$width)}]

# NOTE: the model implemented in OOMMF is not the original Slonczewski model
#  given in the paper published in the 1996 [JMMM 159 (1996)]. It is a more
#  recent model, result of the work of Slonczewski [JMMM 247 (2002)] with the
#  extensions from Xiao [PRB 70, 172405 (2004)]. This mode requires the user
#  to give, beside the polarization P, also another quantity lambda^2. It can
#  be seen from the mathematics, that taking:
#
#     P = a/(2 - 2a) and lambda^2 = (2 - 2a)/(1 - 2a)
#
#  where a = 4 (sqrt(P0)/(1 + P0))^3 and P0 is the polarisation in the
#  Slonczewski model, the Xiao model reduces to the Slonczewski model.

Parameter a [expr 4.0*pow(sqrt($Polarization)/(1.0 + $Polarization), 3.0)]
Parameter lambda2 [expr (2.0 - 2.0*$a)/(1.0 - 2.0*$a)]
Parameter lambda [expr sqrt($lambda2)]
Parameter P [expr $a/(2.0 - 2.0*$a)]

Specify Oxs_BoxAtlas:atlas [subst {
  xrange {0 $length}
  yrange {0 $width}
  zrange {0 $thick}
}]

Specify Oxs_RectangularMesh:mesh [subst {
  cellsize {1.25e-9 1.25e-9 5.0e-9}
  atlas :atlas
}]

# Applied field
Specify Oxs_UZeeman [subst {
  multiplier [expr {0.001/$mu0}]
  Hrange {
     { 0.2 0.2 $Happ  0.2 0.2 $Happ  2 }
  }
}]

# Exchange
Specify Oxs_UniformExchange {A 13e-12}

# No Demag
#Specify Oxs_Demag {}

Specify Oxs_UniaxialAnisotropy {
  axis { 0.0 0.0 1.0 }
  K1   -0.1e6
}

# Evolver
set theta [expr {$theta*$pi/180.}]
set phi   [expr {$phi*$pi/180.}]

#Specify Oxs_EulerEvolve:evolve [subst {
Specify Oxs_SpinXferEvolve:evolve [subst {
  gamma_G 0.221017e6
  alpha 0.014
  start_dm 0.0001
  absolute_step_error 0.02
  relative_step_error 0.02
  max_timestep 5.0e-12
  mp {[expr {sin($theta)*cos($phi)}]
      [expr {sin($theta)*sin($phi)}]
      [expr {cos($theta)}]}
  J_direction "-z"
  J $current_density
  Lambda $lambda
  P $P
  eps_prime 0.0
}]

# Driver
Specify Oxs_TimeDriver [subst {
 basename $basename
 evolver :evolve
 stopping_dm_dt  1e-2
 stopping_time   1.0
 mesh :mesh
 Ms $Ms
 m0 { 1 0.01 0.01}
}]

Destination archive mmArchive
Schedule    DataTable archive                     Step 1
#Schedule    Oxs_TimeDriver::Magnetization archive Step 500
